<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Словарик</title>
    <link rel="stylesheet" href="styles.css">
    <script type="application/javascript" src="data.js"></script>
</head>
<body>
<h1>Словарик</h1>

<!-- Фильтры -->
<div>
    <label><input type="checkbox" id="toggleImage" checked> Картинка</label>
    <label><input type="checkbox" id="toggleActions" checked> Действия (произношение)</label>
    <label><input type="checkbox" id="toggleWord" checked> Англ слово</label>
    <label><input type="checkbox" id="toggleExample" checked> Пример на англ</label>
    <label><input type="checkbox" id="toggleTranslation" checked> Рус слово</label>
    <label><input type="checkbox" id="toggleExampleTranslation" checked> Пример на русском</label>
</div>

<label for="filter"></label><select id="filter">
    <option value="all">Все слова</option>
    <option value="learned">Выученные</option>
    <option value="notLearned">Невыученные</option>
</select>

<button id="resetStorage">Сброс хранилища</button>

<div>
    Всего слов: <span id="totalWordsCount">0</span>
    Выучено: <span id="learnedWordsCountSpan">0</span>
    Не выучено: <span id="notLearnedWordsCountSpan">0</span>
</div>

<table id="dictionary">
    <thead>
    <tr>
        <th class="column-image">Картинка</th>
        <th class="column-actions">Действия (произношение)</th>
        <th class="column-word">Англ слово</th>
        <th class="column-example">Пример на англ</th>
        <th class="column-translation">Рус слово</th>
        <th class="column-example-translation">Пример на русском</th>
        <th>Напомнить</th>
        <th>Выучено</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>

    const tbody = document.querySelector('#dictionary tbody');
    const filterSelect = document.getElementById('filter');
    const learnedWords = JSON.parse(localStorage.getItem('learnedWords') || '{}');
    const columnVisibility = JSON.parse(localStorage.getItem('columnVisibility') || '{}');

    // Восстановление состояния чекбоксов
    document.getElementById('toggleImage').checked = columnVisibility.toggleImage ?? true;
    document.getElementById('toggleActions').checked = columnVisibility.toggleActions ?? true;
    document.getElementById('toggleWord').checked = columnVisibility.toggleWord ?? true;
    document.getElementById('toggleExample').checked = columnVisibility.toggleExample ?? true;
    document.getElementById('toggleTranslation').checked = columnVisibility.toggleTranslation ?? true;
    document.getElementById('toggleExampleTranslation').checked = columnVisibility.toggleExampleTranslation ?? true;
    filterSelect.value = localStorage.getItem('filter') || 'all';

    // Функция для управления видимостью колонок
    function updateColumnVisibility() {
        document.querySelectorAll('.column-image').forEach(el => el.classList.toggle('hidden', !document.getElementById('toggleImage').checked));
        document.querySelectorAll('.column-actions').forEach(el => el.classList.toggle('hidden', !document.getElementById('toggleActions').checked));
        document.querySelectorAll('.column-word').forEach(el => el.classList.toggle('hidden', !document.getElementById('toggleWord').checked));
        document.querySelectorAll('.column-example').forEach(el => el.classList.toggle('hidden', !document.getElementById('toggleExample').checked));
        document.querySelectorAll('.column-translation').forEach(el => el.classList.toggle('hidden', !document.getElementById('toggleTranslation').checked));
        document.querySelectorAll('.column-example-translation').forEach(el => el.classList.toggle('hidden', !document.getElementById('toggleExampleTranslation').checked));
    }

    function updateCounts() {
        const totalWords = dictionaryData.length;
        const learnedWordsCount = Object.values(learnedWords).filter(v => v).length;
        const notLearnedWordsCount = totalWords - learnedWordsCount;

        document.getElementById('totalWordsCount').textContent = totalWords;
        document.getElementById('learnedWordsCountSpan').textContent = learnedWordsCount;
        document.getElementById('notLearnedWordsCountSpan').textContent = notLearnedWordsCount;
    }

    function renderTable() {
        tbody.innerHTML = '';
        dictionaryData.forEach(entry => {
            if (!entry) return;
            const isLearned = learnedWords[entry[0]] || false;
            if (filterSelect.value === 'learned' && !isLearned) return;
            if (filterSelect.value === 'notLearned' && isLearned) return;

            const row = document.createElement('tr');

            // Картинка
            const imageCell = document.createElement('td');
            imageCell.classList.add('column-image');
            /*const img = document.createElement('img');
            img.src = `pic/${entry[0]}.jpg`;
            img.alt = entry[0];
            imageCell.appendChild(img);*/
            row.appendChild(imageCell);

            // Действия (произношение)
            const actionsCell = document.createElement('td');
            actionsCell.classList.add('column-actions');
            const playEnButton = document.createElement('button');
            playEnButton.textContent = 'En';
            playEnButton.onclick = () => speak(entry[0], 'en-US');
            actionsCell.appendChild(playEnButton);

            const playRuButton = document.createElement('button');
            playRuButton.textContent = 'Ru';
            playRuButton.onclick = () => speak(entry[1], 'ru-RU');
            actionsCell.appendChild(playRuButton);

            const playExampleEnButton = document.createElement('button');
            playExampleEnButton.textContent = 'ExEn';
            playExampleEnButton.onclick = () => speak(entry[2], 'en-US');
            actionsCell.appendChild(playExampleEnButton);

            const playExampleRuButton = document.createElement('button');
            playExampleRuButton.textContent = 'ExRu';
            playExampleRuButton.onclick = () => speak(entry[3], 'ru-RU');
            actionsCell.appendChild(playExampleRuButton);

            row.appendChild(actionsCell);

            // Англ слово
            const wordCell = document.createElement('td');
            wordCell.classList.add('column-word');
            wordCell.textContent = entry[0];
            row.appendChild(wordCell);

            // Пример на англ
            const exampleCell = document.createElement('td');
            exampleCell.classList.add('column-example');
            exampleCell.textContent = entry[2];
            row.appendChild(exampleCell);

            // Рус слово
            const translationCell = document.createElement('td');
            translationCell.classList.add('column-translation');
            translationCell.textContent = entry[1];
            row.appendChild(translationCell);

            // Пример на русском
            const exampleTranslationCell = document.createElement('td');
            exampleTranslationCell.classList.add('column-example-translation');
            exampleTranslationCell.textContent = entry[3];
            row.appendChild(exampleTranslationCell);

            // Напомнить
            const remindCell = document.createElement('td');
            const remindButton = document.createElement('button');
            remindButton.textContent = 'Напомнить';
            remindButton.onclick = () => alert(`Англ слово: ${entry[0]}\nРус слово: ${entry[1]}\nПример на англ: ${entry[2]}\nПример на русском: ${entry[3]}`);
            remindCell.appendChild(remindButton);
            row.appendChild(remindCell);

            // Чекбокс "Выучено"
            const learnedCell = document.createElement('td');
            const learnedCheckbox = document.createElement('input');
            learnedCheckbox.type = 'checkbox';
            learnedCheckbox.checked = isLearned;
            learnedCheckbox.onchange = () => {
                learnedWords[entry[0]] = learnedCheckbox.checked;
                localStorage.setItem('learnedWords', JSON.stringify(learnedWords));
                const row = learnedCheckbox.closest('tr');
                row.classList.add('hidden');
                updateCounts();
            };
            learnedCell.appendChild(learnedCheckbox);
            row.appendChild(learnedCell);

            tbody.appendChild(row);
            updateColumnVisibility();
        });
        updateCounts();
    }

    // Сортировка в случайном порядке
    function shuffleArray(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    // Произношение текста
    function speak(text, lang) {
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = lang;
        msg.rate = 0.5;
        window.speechSynthesis.speak(msg);
    }

    // Сохранение состояния чекбоксов и фильтра
    document.getElementById('filter').addEventListener('change', e => {
        localStorage.setItem('filter', e.target.value);
        renderTable();
    });


    // Сброс хранилища
    document.getElementById('resetStorage').addEventListener('click', () => {
        if (confirm('Внимание! Будут сброшены все выученные слова!')) {
            localStorage.removeItem('learnedWords');
            localStorage.removeItem('columnVisibility');
            localStorage.removeItem('filter');
            location.reload();
        }
    });

    // Обновление видимости колонок при изменении состояния чекбоксов
    ['toggleImage', 'toggleActions', 'toggleWord', 'toggleExample', 'toggleTranslation', 'toggleExampleTranslation'].forEach(id => {
        document.getElementById(id).addEventListener('change', e => {
            columnVisibility[id] = e.target.checked;
            localStorage.setItem('columnVisibility', JSON.stringify(columnVisibility));
            updateColumnVisibility();
        });
    });

    // Инициализация таблицы
    dictionaryData = shuffleArray(dictionaryData);
    if (dictionaryData) {
        renderTable();
    }
</script>
</body>
</html>
